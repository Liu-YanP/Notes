# RPC协议

> RPC(Remote Procedure Call Protocol)-----远程调用服务。两台不同服务器之间进行服务（函数或方法）的调用。

## RPC原理

### RPC架构

一个完整的RPC架构里面包含了四个核心的组件，分别是Client，Client Stub，Server以及Server Stub，这个Stub可以理解为存根。

- 客户端(Client)，服务的调用方。
- 客户端存根(Client Stub)，存放服务端的地址消息，再将客户端的请求参数打包成网络消息，然后通过网络远程发送给服务方。
- 服务端(Server)，真正的服务提供者。
- 服务端存根(Server Stub)，接收客户端发送过来的消息，将消息解包，并调用本地的方法。

### RPC调用过程

![image-20200224151038875](C:\Users\liu\AppData\Roaming\Typora\typora-user-images\image-20200224151038875.png)

(1) 客户端（client）以本地调用方式（即以接口的方式）调用服务；
(2) 客户端存根（client stub）接收到调用后，负责将方法、参数等组装成能够进行网络传输的消息体（将消息体对象序列化为二进制）；
(3) 客户端通过sockets将消息发送到服务端；
(4) 服务端存根( server stub）收到消息后进行解码（将消息对象反序列化）；
(5) 服务端存根( server stub）根据解码结果调用本地的服务；
(6) 本地服务执行并将结果返回给服务端存根( server stub）；
(7) 服务端存根( server stub）将返回结果打包成消息（将结果消息对象序列化）；
(8) 服务端（server）通过sockets将消息发送到客户端；
(9) 客户端存根（client stub）接收到结果消息，并进行解码（将结果消息发序列化）；
(10) 客户端（client）得到最终结果。
**RPC的目标是要把2、3、4、7、8、9这些步骤都封装起来。**
注意：无论是何种类型的数据，最终都需要转换成二进制流在网络上进行传输，数据的发送方需要将对象转换为二进制流，而数据的接收方则需要把二进制流再恢复为对象。

## 单点RPC和分布式RPC服务

- 单点RPC服务：一个A服务一个B服务，点对点服务。

  只需要：**序列化协议**、**传输协议**

- 分布式RPC服务：A服务可以调用多台B服务。

  需要：序列化协议、传输协议、**服务注册发现中心**

  有时候还需要一个：**服务监控管理中心**

[RPC协议底层原理与实现](https://blog.csdn.net/yangxiaobo118/article/details/80678039)

